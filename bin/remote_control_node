#!/usr/bin/env python

from remote_control import Server
from baxter_collaboration.srv import DoAction

import rospy


SERVICE = 'DoAction'
OBJECT_IDS = {
    'left_leg': 17,
    'right_leg': 26,
    'central_frame': 24,
    'top': 21,
    }


def remote_message_to_action(msg):
    action, obj = msg.split(' ')
    obj_id = OBJECT_IDS[obj]
    return (action, obj_id)


class RemoteControlNode:

    name = 'remote_control'

    def __init__(self, port=5000):
        rospy.init_node(self.name)
        self.rc_port = port

    def run(self):
        rospy.wait_for_service(SERVICE)
        self.service = rospy.ServiceProxy(SERVICE, DoAction)
        with Server(port=self.rc_port, callback=self._remote_msg_cb) as rc:
            rc.run()

    def _remote_msg_cb(self, message):
        return self.service(*remote_message_to_action)


if __name__ == "__main__":
    node = RemoteControlNode()
    try:
        rospy.spin()
    except KeyboardInterrupt:
        pass
